<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Campus Wayfinder</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    :root {
      --fed-blue: #00205b;
      --fed-blue-light: #0045a0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
      color: #111827;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
    }

    .header {
      background-color: #fff;
      padding: 12px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }

    .header img {
      height: 40px;
      margin-right: 8px;
    }

    .header-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--fed-blue);
    }

    /* Mobile/Tablet default nav */
    .nav {
      background-color: #fff;
      width: 95%;
      max-width: 900px;
      margin-top: 10px;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }

    .nav label {
      font-size: 13px;
      color: #555;
    }

    .nav select {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: #fff;
      font-size: 14px;
      width: 100%;
    }

    .nav button {
      background-color: var(--fed-blue);
      color: white;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }

    .nav button:hover {
      background-color: var(--fed-blue-light);
    }

    .icon-button {
      background-color: #f3f4f6;
      color: #333;
      font-size: 14px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
      cursor: pointer;
    }

    .icon-button:hover {
      background-color: #e5e7eb;
    }

    #map {
      flex: 1;
      height: calc(100vh - 220px);
      width: 100%;
    }

    /* Desktop/Laptop layout */
    @media (min-width: 1024px) {
      .nav {
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
        width: 100%;
        max-width: 100%;
        border-radius: 0;
        box-shadow: none;
        margin: 0;
      }

      .nav label {
        margin: 0;
        font-size: 14px;
        white-space: nowrap;
      }

      .nav select {
        width: auto;
        min-width: 200px;
      }

      .nav button,
      .icon-button {
        width: auto;
      }

      #map {
        height: calc(100vh - 120px);
      }
    }

    .filters-popup {
      position: absolute;
      top: 60px;
      right: 20px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 16px;
      width: 280px;
      z-index: 2000;
      display: none;
    }

    .filters-popup h3 {
      margin-bottom: 10px;
      font-size: 16px;
      font-weight: 600;
    }

    .filters-popup label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-size: 14px;
      font-weight: 500;
    }

    .filters-popup select,
    .filters-popup button {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    .filters-popup button {
      margin-top: 12px;
      background-color: var(--fed-blue);
      color: white;
      border: none;
      cursor: pointer;
    }

    .filters-popup button:hover {
      background-color: var(--fed-blue-light);
    }
    /* --- Feedback button & modal --- */
#openFeedbackBtn {
  position: fixed;
  right: 20px;
  bottom: 20px;
  z-index: 3500;
  background: #111827;
  color: #fff;
  border: none;
  border-radius: 999px;
  padding: 10px 14px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
}
#openFeedbackBtn:hover { opacity: .9; }

.feedback-modal-backdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  z-index: 4000;
}
.feedback-modal {
  position: absolute;
  left: 50%;
  top: 50%;
  width: min(92vw, 420px);
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
  padding: 16px;
}
.feedback-modal h3 { font-size: 18px; color: var(--fed-blue); margin-bottom: 8px; }
.feedback-modal p.hint { font-size: 13px; color: #6b7280; margin-bottom: 12px; }

/* Stars */
.stars { display: inline-flex; flex-direction: row-reverse; gap: 4px; }
.stars input { display: none; }
.stars label {
  font-size: 28px; cursor: pointer; color: #d1d5db; transition: transform .05s;
}
.stars label:hover, .stars label:hover ~ label { color: #f59e0b; }
.stars input:checked ~ label { color: #f59e0b; }
.stars label:active { transform: scale(0.95); }

.feedback-modal textarea {
  width: 100%; min-height: 84px; margin-top: 12px;
  border: 1px solid #d1d5db; border-radius: 8px; padding: 10px;
  font-family: 'Inter', sans-serif; font-size: 14px; resize: vertical;
}
.feedback-actions { display: flex; gap: 8px; margin-top: 14px; }
.feedback-actions button {
  flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer;
}
#submitFeedbackBtn { background: var(--fed-blue); color: #fff; }
#cancelFeedbackBtn { background: #e5e7eb; color: #111827; }

.feedback-toast {
  display: none; position: fixed; left: 50%; bottom: 90px; transform: translateX(-50%);
  background: #16a34a; color: #fff; padding: 10px 14px; border-radius: 8px; z-index: 4500; font-weight: 600;
}

/* Screen-reader only helper */
.sr-only {
  position: absolute !important; height: 1px; width: 1px; overflow: hidden;
  clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; border: 0; padding: 0; margin: -1px;
}
  </style>
</head>
<body>
  <div class="header">
    <img src="FedUniLogo.jpeg" alt="Federation University Logo" />
    <div class="header-title">CAMPUS WAYFINDER</div>
  </div>

  <div class="nav">
    <button onclick="window.location.href='https://www.federation.edu.au/'">← Back</button>

    <label for="start">Start:</label>
    <select id="start"></select>

    <label for="destination">Destination:</label>
    <select id="destination"></select>

    <button onclick="generateRoute()">Search</button>
    <span class="icon-button" onclick="toggleFilters()">☰ Filters</span>
  </div>

  <div id="map"></div>

  <div class="filters-popup" id="filtersPopup">
    <button style="float:right; background:none; border:none; font-size:20px; cursor:pointer;" onclick="toggleFilters()">&times;</button>
    <h3>Filters</h3>
    <label for="direction">By Direction</label>
    <select id="direction">
      <option value="">None</option>
      <option value="N">North</option>
      <option value="E">East</option>
      <option value="S">South</option>
      <option value="W">West</option>
    </select>

    <label for="department">By Department</label>
    <select id="department">
      <option>None</option>
      <option>Institute of Education, Arts, and Community</option>
      <option>Institute of Health and Wellbeing</option>
      <option>Institute of Innovation, Science and Sustainability</option>
    </select>

    <button id="applyFiltersBtn">Apply</button>
    <button id="clearFiltersBtn" style="margin-top: 8px; background-color: #6b7280;">Clear</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const buildingOptions = {
      "Aboriginal Education Centre (Building 1S, Level 1)": { lat: -38.31215, lng: 146.42988 },
  "Auditorium (Building 3E)": { lat: -38.31093, lng: 146.43044 },
  "Bistro (Building 2N)": { lat: -38.31136, lng: 146.42903 },
  "Bookshop (Building 4N, Level 1)": { lat: -38.31101, lng: 146.42844 },
  "Cafeteria (Building 2N)": { lat: -38.31136, lng: 146.42903 },
  "Centre for Gippsland Studies (Building 1E, Level 1)": { lat: -38.31101, lng: 146.42939 },
  "CLIPP (Building 1E, Level 1)": { lat: -38.31101, lng: 146.42939 },
  "Chaplain (Building 3N)": { lat: -38.31101, lng: 146.42898 },
  "Clubs and Societies Space (Building 1E, Level 1)": { lat: -38.31101, lng: 146.42939 },
  "Commercial Services Centre (Building 4N, Level 1)": { lat: -38.31101, lng: 146.42844 },
  "Crofton Hatsell Room (Building 2W, Level 2)": { lat: -38.31190, lng: 146.42886 },
  "Fedliving Office (Building 4N, Level 1)": { lat: -38.31101, lng: 146.42844 },
  "GHERG (Building 4W)": { lat: -38.31250, lng: 146.42779 },
  "Kurnai College (Building 5W/6W)": { lat: -38.31223, lng: 146.42689 },
  "Gippsland Enterprise Centre (Building 9N)": { lat: -38.30931, lng: 146.42564 },
  "Gippsland Centre for Arts and Design (Building 6S, Level 1)": { lat: -38.31353, lng: 146.43143 },
  "Grounds Department (Building 5S)": { lat: -38.31368, lng: 146.43082 },
  "Hexagon Theatre (Building 1S, Level 1)": { lat: -38.31218, lng: 146.42991 },
  "ITS Services (Building 1E, Level 2)": { lat: -38.31101, lng: 146.42939 },
  "Leisure Centre (Building LC)": { lat: -38.31146, lng: 146.42514 },
  "Library (Building 1E, Level 1)": { lat: -38.31101, lng: 146.42939 },
  "Link Meeting Room (Building 2W, Level 2)": { lat: -38.31190, lng: 146.42886 },
  "Main Entrance (Building 1W, Level 2)": { lat: -38.31196, lng: 146.42947 },
  "Monash Rural Health (Building 3W, Level 2)": { lat: -38.31223, lng: 146.42855 },
  "Parenting Rooms (Building 1N, Level 1 / 1E, Level 1)": { lat: -38.31127, lng: 146.42947 },
  "Property and Infrastructure (Building 3W)": { lat: -38.31223, lng: 146.42855 },
  "Quiet Space / Prayer Room (Building 1N, Level 1)": { lat: -38.31167, lng: 146.42954 },
  "Logistics and Mail Room (Building 4N)": { lat: -38.31101, lng: 146.42844 },
  "Research and Innovation (Building 2W, Level 2)": { lat: -38.31190, lng: 146.42886 },
  "Student Experience (Building 3N)": { lat: -38.31100, lng: 146.42898 },
  "Student HQ (Building 1S, Level 2, Room 203)": { lat: -38.31218, lng: 146.42991 },
  "Student Lounge (Building 3N)": { lat: -38.31101, lng: 146.42898 },
  "Student Residences – Hall A (HA)": { lat: -38.31111, lng: 146.42597 },
  "Student Residences – Hall B (HB)": { lat: -38.31314, lng: 146.42653 },
  "North Residences (Building 7N)": { lat: -38.31042, lng: 146.42880 },
  "South Residences (South Res)": { lat: -38.31496, lng: 146.42883 },
  "West Residences (West Res)": { lat: -38.31451, lng: 146.42576 },
  "Student Senate Office (Building 3N)": { lat: -38.31100, lng: 146.42897 },
  "Switchback Gallery (Building 6S)": { lat: -38.31353, lng: 146.43143 },
 
    };

    let currentRoute = null;
    const startSelect = document.getElementById('start');
    const destSelect = document.getElementById('destination');
    const directionSelect = document.getElementById('direction');
    const applyBtn = document.getElementById('applyFiltersBtn');
    const clearBtn = document.getElementById('clearFiltersBtn');

    function populateOptions() {
      startSelect.innerHTML = '<option value="">Select</option>';
      destSelect.innerHTML = '<option value="">Select</option>';
      Object.keys(buildingOptions).forEach(name => {
        let opt1 = document.createElement('option');
        opt1.value = name; opt1.textContent = name;
        let opt2 = opt1.cloneNode(true);
        startSelect.appendChild(opt1);
        destSelect.appendChild(opt2);
      });
    }

    function generateRoute() {
      const startName = startSelect.value;
      const endName = destSelect.value;
      if (!startName || !endName) {
        alert("Select both start and destination.");
        return;
      }
      const start = buildingOptions[startName];
      const end = buildingOptions[endName];
      if (currentRoute) map.removeLayer(currentRoute);
      currentRoute = L.polyline([start, end], { color: 'blue', weight: 5 }).addTo(map);
      map.fitBounds(currentRoute.getBounds());
    }

    function applyFilters() {
      const dir = directionSelect.value;
      startSelect.innerHTML = '<option value="">Select</option>';
      destSelect.innerHTML = '<option value="">Select</option>';
      Object.entries(buildingOptions).forEach(([name, data]) => {
        if (!dir || data.direction === dir) {
          let opt1 = document.createElement('option');
          opt1.value = name; opt1.textContent = name;
          let opt2 = opt1.cloneNode(true);
          startSelect.appendChild(opt1);
          destSelect.appendChild(opt2);
        }
      });
    }

    function clearFilters() {
      directionSelect.value = "";
      populateOptions();
    }

    applyBtn.addEventListener("click", applyFilters);
    clearBtn.addEventListener("click", clearFilters);

    function toggleFilters() {
      const popup = document.getElementById("filtersPopup");
      popup.style.display = popup.style.display === "block" ? "none" : "block";
    }

    // Map init
    const map = L.map('map').setView([-38.3126, 146.4280], 18);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // GPS tracking
    let userMarker, accuracyCircle, headingMarker;
    const arrowIcon = L.divIcon({
      className: 'heading-arrow',
      html: '🧭',
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    });

    map.locate({ watch: true, setView: false, maxZoom: 20 });
    map.on("locationfound", function (e) {
      if (!userMarker) {
        userMarker = L.marker(e.latlng).addTo(map).bindPopup("You are here");
        accuracyCircle = L.circle(e.latlng, { radius: 5, color: '#007bff', fillColor: '#007bff', fillOpacity: 0.3 }).addTo(map);
        headingMarker = L.marker(e.latlng, { icon: arrowIcon }).addTo(map);
      } else {
        userMarker.setLatLng(e.latlng);
        accuracyCircle.setLatLng(e.latlng).setRadius(e.accuracy);
        headingMarker.setLatLng(e.latlng);
      }
    });

    map.on("locationerror", e => alert("Location error: " + e.message));

    function handleOrientation(event) {
      const heading = event.alpha;
      if (heading != null && headingMarker && headingMarker.getElement()) {
        headingMarker.getElement().style.transform = `rotate(${heading}deg)`;
      }
    }

    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      DeviceOrientationEvent.requestPermission().then(state => {
        if (state === 'granted') {
          window.addEventListener('deviceorientation', handleOrientation, true);
        }
      }).catch(console.error);
    } else {
      window.addEventListener('deviceorientationabsolute', handleOrientation, true);
      window.addEventListener('deviceorientation', handleOrientation, true);
    }

    window.onload = populateOptions;
  </script>
  <!-- Floating Feedback Button -->
<button id="openFeedbackBtn" aria-haspopup="dialog" aria-controls="feedbackModalBackdrop" aria-label="Open feedback form">
  ★ Feedback
</button>

<!-- Modal Backdrop + Dialog -->
<div id="feedbackModalBackdrop" class="feedback-modal-backdrop" role="presentation">
  <div class="feedback-modal" role="dialog" aria-modal="true" aria-labelledby="feedbackTitle">
    <h3 id="feedbackTitle">Rate your Wayfinder experience</h3>
    <p class="hint">How helpful was this page? (1 = not helpful, 5 = very helpful)</p>

    <div class="stars" role="radiogroup" aria-label="Star rating">
      <input type="radio" name="rating" id="star5" value="5" />
      <label for="star5" aria-label="5 stars">★</label>

      <input type="radio" name="rating" id="star4" value="4" />
      <label for="star4" aria-label="4 stars">★</label>

      <input type="radio" name="rating" id="star3" value="3" />
      <label for="star3" aria-label="3 stars">★</label>

      <input type="radio" name="rating" id="star2" value="2" />
      <label for="star2" aria-label="2 stars">★</label>

      <input type="radio" name="rating" id="star1" value="1" />
      <label for="star1" aria-label="1 star">★</label>
    </div>

    <label for="feedbackText" class="sr-only">Optional comment</label>
    <textarea id="feedbackText" placeholder="Any comments? (optional)"></textarea>

    <div class="feedback-actions">
      <button id="submitFeedbackBtn">Submit</button>
      <button id="cancelFeedbackBtn" type="button">Cancel</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="feedbackToast" class="feedback-toast" role="status" aria-live="polite">
  Thanks for your feedback!
</div>
<script>
  // --- Feedback modal logic ---
  const openFbBtn   = document.getElementById('openFeedbackBtn');
  const fbBackdrop  = document.getElementById('feedbackModalBackdrop');
  const submitFbBtn = document.getElementById('submitFeedbackBtn');
  const cancelFbBtn = document.getElementById('cancelFeedbackBtn');
  const fbToast     = document.getElementById('feedbackToast');
  const fbTextarea  = document.getElementById('feedbackText');

  // Trap focus inside dialog + Esc to close
  function trapFocus(e) {
    if (fbBackdrop.style.display !== 'block') return;
    const focusable = fbBackdrop.querySelectorAll('button, [href], input, textarea, [tabindex]:not([tabindex="-1"])');
    if (!focusable.length) return;
    const first = focusable[0];
    const last  = focusable[focusable.length - 1];
    if (e.key === 'Tab') {
      if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
    } else if (e.key === 'Escape') { closeFeedback(); }
  }

  function openFeedback() {
    fbBackdrop.style.display = 'block';
    if (![...document.querySelectorAll('.stars input')].some(r => r.checked)) {
      document.getElementById('star5').checked = true;
    }
    document.getElementById('star5').focus();
    document.addEventListener('keydown', trapFocus);
    document.body.style.overflow = 'hidden';
  }

  function closeFeedback() {
    fbBackdrop.style.display = 'none';
    openFbBtn.focus();
    document.removeEventListener('keydown', trapFocus);
    document.body.style.overflow = '';
  }

  openFbBtn.addEventListener('click', openFeedback);
  cancelFbBtn.addEventListener('click', closeFeedback);
  fbBackdrop.addEventListener('click', (e) => { if (e.target === fbBackdrop) closeFeedback(); });

  submitFbBtn.addEventListener('click', () => {
    const selected = document.querySelector('.stars input:checked');
    const rating = selected ? Number(selected.value) : null;
    const comment = fbTextarea.value.trim();

    if (!rating) { alert('Please choose a star rating (1–5).'); return; }

    const payload = { rating, comment, path: location.pathname, ts: new Date().toISOString() };

    // Save locally for now
    try {
      const key = 'wayfinderFeedback';
      const existing = JSON.parse(localStorage.getItem(key) || '[]');
      existing.push(payload);
      localStorage.setItem(key, JSON.stringify(existing));
    } catch (err) { console.error('Failed to store feedback:', err); }

    // Reset + close + toast
    fbTextarea.value = '';
    document.querySelectorAll('.stars input').forEach(i => i.checked = false);
    closeFeedback();
    fbToast.style.display = 'block';
    setTimeout(() => { fbToast.style.display = 'none'; }, 2200);

    // To send to your backend later:
    // fetch('/api/feedback', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  });
</script>

</body>
</html>

